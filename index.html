<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>matematicacion cerebral</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <link rel="icon" type="image/png" href="https://cdn.glitch.global/0815d8f1-74c4-4ba4-b685-8bb2e0ed9747/favicon.png?v=1724028825369">
    </head>
    <body style="overflow: hidden;">
        <canvas style="position: absolute; left: 0; top: 0; background-color: #deb176;"></canvas>
        <script>
            const canvas = document.querySelector("canvas")
            const ctx = canvas.getContext("2d")
            canvas.width = window.innerWidth
            canvas.height = window.innerHeight
            const _scale = canvas.height * .2
            function screenPointTogamePoint(x,y) {
                return {x: (x - canvas.width*.5)/_scale,y: (y - canvas.height*.5)/_scale}
            }

            const mousePos = {x: 0, y: 0}
            const gameMousePos = {x: 0, y: 0}
            var selectedBoton = null
            var typing = false
            var resultString = ""

            function isMobileDevice() {
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
                return mobileRegex.test(navigator.userAgent);
            }

            const _touchEnabled = isMobileDevice()

            if (_touchEnabled) {
                ontouchmove = function(ev) {
                    const touch = [...ev.changedTouches][0]
                    const oooo = screenPointTogamePoint(touch.clientX, touch.clientY)
                    gameMousePos.x = oooo.x
                    gameMousePos.y = oooo.y
                }
            } else {
                onmousemove = function(ev) {
                    mousePos.x = ev.clientX
                    mousePos.y = ev.clientY
                    const conv = screenPointTogamePoint(mousePos.x, mousePos.y)
                    gameMousePos.x = conv.x
                    gameMousePos.y = conv.y
                }
            }

            const typable = {
                ["1"]: true,["2"]: true,["3"]: true,["4"]: true,["5"]: true,
                ["6"]: true,["7"]: true,["8"]: true,["9"]: true,["0"]: true,
                ["-"]: true
            }
            var vidas = 3
            var vidasY = -3.5
            var puntaje = 0

            function onEnterKey() {
                if (selectedBoton != null) {
                                    typing = false
                if (resultString != "" && resultString != "-") {
                    if (selectedBoton.result == parseInt(resultString)) {
                        puntaje += 1
                        selectedBoton.waitTime = 1
                        selectedBoton.temp = 1
                        selectedBoton.bieeen = true
                    } else {
                        vidas -= 1
                    }
                    resultString = ""
                }
                selectedBoton = null
                }
            }

            onkeydown = function(ev) {
                if (typing && ev.key == "Enter") {
                    onEnterKey()
                }

                if (typing && ev.keyCode == 8 && resultString.length > 0) {
                    resultString = resultString.slice(0, resultString.length - 1)
                }

                if (typing && typable[ev.key]) {
                    var foundMINUS = false
                    if (ev.key=="-") {
                        foundMINUS = resultString.charAt(0) == "-"
                        if (resultString.length > 0) {
                            foundMINUS = true
                        }
                    }
                    if (!foundMINUS) resultString = resultString + ev.key
                }
            }

            var _lastTime = Date.now()*.001
            var _time = _lastTime
            const botonImage = new Image()
            botonImage.src = "boton.png"
            const botonImageWW = new Image()
            botonImageWW.src = "botonwhite.png"
            const jugarImage = new Image()
            jugarImage.src = "jugar.png"
            const tituloImage = new Image()
            tituloImage.src = "titulo.png"
            const botonBIEN = new Image()
            botonBIEN.src = "botonBIEN.png"
            const numerosIMG = new Image()
            numerosIMG.src = "numeros.png"
            const corazonIMG = new Image()
            corazonIMG.src = "corazon.png"
            const corazonF = new Image()
            corazonF.src = "corazxonF.png"
            const puntajecion = new Image()
            puntajecion.src = "puntajecion.png"
            const perdisteIMG = new Image()
            perdisteIMG.src = "perdiste.png"
            const nuemros2 = new Image()
            nuemros2.src = "numeros2.png"
            const ppppp = new Image()
            const circleIMG = new Image()
            circleIMG.src = "circle.png"
            ppppp.src = "puntajec2.png"
            const barraIMG= new Image()
            barraIMG.src = "barra.png"
            const settingsIMG= new Image()
            settingsIMG.src = "settings.png"
            const titulo = {
                y: -3,
                v: 0,
                begone: false,
                update: true
            }

            const _signos = [
                "+","e","/","-","*"
            ]

            const menuOGG = new Audio("menu.ogg")
            const jueogOGG = new Audio("juego.ogg")
            const perdiOGG = new Audio("perdicion.ogg")
            const clickToPlay = new Image()
            var settingsButton = undefined
            clickToPlay.src = "click para jugar.png"
            var estado = 0
            var perdisteY = 4
            var resueltas = 0
            const cacanut = 100/128*.6
            var botones = {}
            var DIFFICULTY = 0
            var BARRAHELD = false

            class Boton {
                constructor(x, y) {
                    this.x = x
                    this.time = 0
                    this.y = y
                    this.s = 0
                    this.rm = Math.random()-.5
                    this.r = 0
                    this.id = 0
                    this.waitTime = 0
                    this.ss = 0
                    this.hovered = false
                    this.begone = false
                    this.bieeen = false
                    this.w = 1
                    this.miiimi = false
                    this.temp = 1
                    this.img = 0
                    this.n1 = Math.round(Math.random()*9)
                    this.caca()
                }

                caca() {
                    this.n1 = Math.round(Math.random()*9)
                    this.signo = Math.round(Math.random()*4)
                    if (this.signo == 1) this.n2 = Math.round(Math.random()*2)+1
                    else this.n2 = Math.round(Math.random()*9)
                    switch (this.signo) {
                        case 0:
                            this.result = this.n1+this.n2
                            break;
                        case 1:
                            this.result = Math.pow(this.n1,this.n2)
                            break;
                        case 2:
                            if (this.n2 < 1) this.n2 = 1

                            if (this.n2 == 2) {
                                if (this.n1 == 1) this.n1 = 2
                                if (this.n1 == 3) this.n1 = 4
                                if (this.n1 == 5) this.n1 = 6
                                if (this.n1 == 7) this.n1 = 8
                                if (this.n1 == 9) this.n1 = 0
                            } else if (this.n2 == 3) {
                                if (this.n1 == 2 || this.n1 == 4) this.n1 = 3
                                if (this.n1 == 5 || this.n1 == 7) this.n1 = 6
                                if (this.n1 == 8) this.n1 = 9
                            } else if (this.n2 == 4) {
                                if (this.n1 < 4) this.n1 = 4
                                if (this.n1 > 4) this.n1 = 8
                            } else if (this.n2 == 5) {
                                if (this.n1 < 5) this.n1 = 5
                                if (this.n1 > 5) this.n1 = 10
                            } else if (this.n2 == 6) {
                                if (this.n1 < 6) this.n1 = 6
                                if (this.n1 > 6) this.n1 = 12
                            } else if (this.n2 == 7) {
                                if (this.n1 < 7) this.n1 = 7
                                if (this.n1 > 7) this.n1 = 14
                            } else if (this.n2 == 8) {
                                if (this.n1 < 8) this.n1 = 8
                                if (this.n1 > 8) this.n1 = 16
                            } else if (this.n2 == 9) {
                                if (this.n1 < 9) this.n1 = 9
                                if (this.n1 > 9) this.n1 = 18
                            }

                            this.result = this.n1/this.n2
                            break;
                        case 3:
                            this.result = this.n1-this.n2
                            break;
                        case 4:
                            this.result = this.n1*this.n2
                            break;
                        default:
                            this.result = 0
                            break;
                    }
                }

                update(dt) {
                    if (vidas < 1) return

                    if (this.time > 0) {
                        this.time -= dt
                        return
                    }

                    if (this.img == 0) {
                        if (this.waitTime > 0) {
                            if (resueltas > 2) this.waitTime -= dt
                            this.miiimi = true
                        } else {
                            if (this.miiimi) {
                                this.miiimi = false
                                this.caca()
                            }
                            this.bieeen = false
                            this.temp -= dt*.0175*(DIFFICULTY+1)
                            if (this.temp < 0) {
                                this.temp = 1
                                vidas -= 1
                            }
                        }
                    }

                    if (!_touchEnabled) this.hovered = Math.abs(gameMousePos.x - this.x) < this.w*.5 && Math.abs(gameMousePos.y - this.y) < .5
                    if (BARRAHELD) this.hovered = false
                    var wscale = 1
                    if (this.hovered) wscale = 1.15
                    const dif = (wscale - this.s) * dt * 15
                    this.s += this.ss * dt
                    this.s += dif
                    this.ss += dif*20
                    this.r = (1-this.s)*this.rm
                    if (this.begone) {
                        this.y += (4 - this.y) * dt * 5
                        if (this.y > 3.5) {
                            delete botones[this.id]
                        }
                    }
                }
            }

            function addBoton(x,y,time) {
                const boton = new Boton(x,y);
                boton.id = Math.random()
                boton.time = time
                botones[boton.id] = boton
                return boton
            }

            function drawDigit(x,y,d,u) {
                ctx.drawImage(u, d*50, 0, 50, 50, -cacanut*.5+x, -cacanut*.5+y, cacanut, cacanut)
            }

            const cacanut22 = {
                ["1"]: 0,["2"]: 1,["3"]: 2,["4"]: 3,["5"]: 4,
                ["6"]: 5,["7"]: 6,["8"]: 7,["9"]: 8,["0"]: 9,
                ["+"]: 10, ["-"]: 11, ["*"]: 12, ["/"]: 13, ["e"]: 14
            }
            function drawTXT(x,y,text,img) {
                if (img == undefined) img = numerosIMG
                for (var i = 0; i < text.length; i++) {
                    const char = text.charAt(i)
                    drawDigit(x+i*cacanut*.5-(text.length-1)*cacanut*.25, y,cacanut22[char],img)
                }
            }

            var _playing = false
            var BARRAHOVERED = false
            var BARRADIF = 0
            var BARRALERP = 0

            function onmousedow() {
                _playing = true
                var hoveredButton = null
                for (var i in botones) {
                    const boton = botones[i]
                    if (_touchEnabled) boton.hovered = Math.abs(gameMousePos.x - boton.x) < boton.w*.5 && Math.abs(gameMousePos.y - boton.y) < .5
                    if (boton.hovered) {
                        hoveredButton = boton
                        if (_touchEnabled) boton.hovered = true
                        break
                    }
                }

                if (hoveredButton != null && !_touchEnabled && hoveredButton.time <= 0) {
                    if (hoveredButton.w == 4) {
                        hoveredButton.begone = true
                        settingsButton.begone = true
                        onPlay()
                    } else if (hoveredButton.bieeen == false && hoveredButton.img == 0) {
                        selectedBoton = hoveredButton
                        typing = true
                        resultString = ""
                    }
                }

                if (_touchEnabled) {
                    const caca=78/128*.5
                    BARRAHOVERED = Math.abs(BARRAX*78/128-gameMousePos.x)<caca && Math.abs(gameMousePos.y-(titulo.y+.5))<caca
                }
                
                if (BARRAHOVERED) {
                    BARRAHELD = true
                    BARRADIF = BARRALERP - Math.max(Math.min(gameMousePos.x*(128/546)+.5, 1), 0)
                }
            }

            if (_touchEnabled) {
                ontouchstart = function(ev) {
                    const touches = [...ev.changedTouches]
                    if (touches[0]) {
                        const touch = touches[0]
                        const oooo = screenPointTogamePoint(touch.clientX, touch.clientY)
                        gameMousePos.x = oooo.x
                        gameMousePos.y = oooo.y
                        onmousedow()
                    }
                }

                ontouchend = function(ev) {
                    const touches = [...ev.changedTouches]
                    if (touches[0]) {
                        const touch = touches[0]
                        const oooo = screenPointTogamePoint(touch.clientX, touch.clientY)
                        gameMousePos.x = oooo.x
                        gameMousePos.y = oooo.y

                        if (_touchEnabled) {
                            var hoveredButton = null
                            for (var i in botones) {
                                const boton = botones[i]
                                if (_touchEnabled) boton.hovered = Math.abs(gameMousePos.x - boton.x) < boton.w*.5 && Math.abs(gameMousePos.y - boton.y) < .5
                                if (boton.hovered) {
                                    hoveredButton = boton
                                    break
                                }
                            }

                            if (hoveredButton != null && _touchEnabled && hoveredButton.time <= 0) {
                                hoveredButton.hovered = false
                                if (hoveredButton.w == 4) {
                                    hoveredButton.begone = true
                                    settingsButton.begone = true
                                    onPlay()
                                } else if (hoveredButton.bieeen == false && hoveredButton.img == 0) {
                                    selectedBoton = hoveredButton
                                    typing = true
                                    resultString = ""
                                }
                            }
                        }

                        if (typing) {
                        const xdd = vidasY*3.5+5.5
                        var wanting = null
                        for (var i = 0; i < 12; i++) {
                            var x = ((i%3-1)*.5-xdd*1.5-.9-.6)*1.25
                            var y = ((Math.floor(i/3)-1)*.5-.25)*1.25
                            var difx = Math.abs(x-gameMousePos.x)
                            var dify = Math.abs(y-gameMousePos.y)
                            if (difx<.3125 && dify<.3125) {
                                if (i < 9) wanting = (i+1) + ""
                                else if (i == 9) wanting = "-"
                                else if (i == 10) wanting = "0"
                                else if (i == 11) resultString = resultString.substring(0, resultString.length-1)
                            }
                        }

                        if (wanting != null) {
                            var foundMINUS = false
                            if (wanting=="-") {
                                foundMINUS = resultString.charAt(0) == "-"
                                if (resultString.length > 0) {
                                    foundMINUS = true
                                }
                            }
                            if (!foundMINUS) resultString = resultString + wanting
                        }
                        }

                        if (gameMousePos.y > 1.6 && gameMousePos.y < 2.4 && typing) {
                            onEnterKey()
                        }

                        BARRAHELD = false
                        BARRAHOVERED = false
                        BARRADIF = 0
                    }
                }
            } else {
                onmousedown = function(ev) {
                    onmousedow(gameMousePos)
                }
                onmouseup = function(ev) {
                    BARRAHELD = false
                    BARRADIF = 0
                }
            }

            function onPlay() {
                estado = 1
                titulo.begone = true
                for (var i = 0; i < 9; i++) {
                    addBoton((i%3-1)*1.2, Math.floor(i/3)-1, i*.06)
                }
            }

            function init() {
                const xd = addBoton(-.5, 1.5, 0.35)
                xd.img = 1
                xd.w = 4
                const xd2 = addBoton(2.25, 1.5, 0.45)
                xd2.img = 2
                settingsButton = xd2
            } init()

            var _typeScale = 0
            var BARRAANIM = 0
            var BARRAVEL = 0
            var BARRAS = 1
            var BARRAX = 0
            function update(dt) {
                if (!_playing) return

                if (!typing) {
                    _typeScale =0
                } else {
                    _typeScale += (1-_typeScale)*dt*10
                }

                resueltas = 0
                for (var i in botones) {
                    if (botones[i].bieeen) resueltas += 1
                }

                for (var i in botones) {
                    const boton = botones[i]
                    boton.update(dt)
                }

                if (titulo.update) {
                    const lerp = (1-BARRAANIM)*dt*10
                    BARRAANIM += lerp
                    BARRAANIM += BARRAVEL * dt
                    BARRAVEL += lerp * 15
                    const caca=78/128*.5
                    if (!_touchEnabled) BARRAHOVERED = Math.abs(BARRAX*78/128-gameMousePos.x)<caca && Math.abs(gameMousePos.y-(titulo.y+.5))<caca
                    if (BARRAHOVERED || BARRAHELD) BARRAS += (1.25-BARRAS)*dt*16
                    else BARRAS += (1-BARRAS)*dt*16
                    if (BARRAHELD) BARRALERP = Math.max(Math.min(gameMousePos.x*(128/546)+.5+BARRADIF, 1), 0)
                    BARRAX = (-7 + 14 * BARRALERP)*.5
                    DIFFICULTY = Math.min(Math.floor(BARRALERP*6),5)
                    titulo.y += titulo.v * dt
                    if (titulo.begone) titulo.v -= dt * 60
                    else titulo.v += dt * 50
                    if (titulo.y > 0) {
                        titulo.y = 0
                        if (titulo.v < 6) titulo.v = 0
                        else titulo.v *= -.5
                    }

                    if (titulo.y < -4) {
                        titulo.update = false
                    }
                } else {
                    vidasY += (-2.3 - vidasY) * dt * 10
                }

                if (vidas < 1) {
                    estado = 2
                    perdisteY += (0-perdisteY)*dt*5;typing = false
                }

                if (estado == 0) {
                    menuOGG.play()
                    menuOGG.loop = true
                    jueogOGG.pause()
                    perdiOGG.pause()
                } else if (estado == 1) {
                    jueogOGG.play()
                    jueogOGG.loop = true
                    menuOGG.pause()
                    perdiOGG.pause()
                } else if (estado == 2) {
                    perdiOGG.play()
                    perdiOGG.loop = true
                    menuOGG.pause()
                    jueogOGG.pause()
                }
            }
            var CACACACA = 0
            var _placeBOTON = 0
            function render(dt) {
                if (!_playing) { ctx.drawImage(clickToPlay, -1.5, -.5, 3, 1); return}

                if (estado > 0) {
                    if (CACACACA < 1) {
                        CACACACA = Math.min(CACACACA + dt*.5, 1)
                        ctx.globalAlpha=1-Math.pow(1-CACACACA,3)
                    } else {
                        ctx.globalAlpha = 1
                    }
                    ctx.fillStyle = "#c99c61"
                    ctx.beginPath()
                    ctx.arc(0, 0, 2, 0, Math.PI * 2)
                    ctx.closePath()
                    ctx.fill()
                    ctx.globalAlpha = 1
                }

                ctx.fillStyle = "black"
                for (var i in botones) {
                    const boton = botones[i]
                    const s = boton.s*-.5
                    ctx.save()
                    ctx.rotate(boton.r)
                    ctx.translate(s*boton.w+boton.x, s+boton.y)
                    ctx.scale(boton.s, boton.s)
                    var imagen = null
                    if (boton.img == 0) {
                        if (selectedBoton == boton) imagen = botonImageWW
                        else imagen = botonImage
                    }
                    else if (boton.img == 1) imagen = jugarImage
                    else imagen = settingsIMG
                    if (boton.bieeen) imagen = botonBIEN
                    ctx.drawImage(imagen, 0, 0, boton.w, 1)
                    if (boton.img == 0) {
                        drawTXT(.5,.4,boton.n1+_signos[boton.signo]+boton.n2)
                        ctx.fillStyle = "rgba(255,0,0,0.25)"
                        ctx.fillRect(.05, .04, 1-.1, (1-boton.temp)*(1-.08))
                    }
                    ctx.restore()
                }

                if (titulo.update) {
                    const w = 721/128
                    const h = 237/128
                    ctx.drawImage(tituloImage, -w*.5, titulo.y-h, w,h)

                    ctx.save()
                    const XD = 78/128*BARRAANIM
                    ctx.translate(0,titulo.y+.5)
                    ctx.scale(XD,XD)
                    ctx.drawImage(barraIMG, -7*.5, -.5, 7, 1)
                    ctx.drawImage(circleIMG, -.5*BARRAS+BARRAX, -.5*BARRAS, 1*BARRAS, 1*BARRAS)
                    drawTXT(BARRAX, 0, (DIFFICULTY+1)+"")
                    _placeBOTON = (_placeBOTON+dt*.0175*(DIFFICULTY+1))%1
                    ctx.drawImage(botonImage, 3.5+Math.max(BARRAX-2.7,0), -.75, 1.5, 1.5)
                    ctx.fillStyle = "rgba(255,0,0,0.25)"
                    ctx.fillRect(3.5+.07+Math.max(BARRAX-2.7,0), -.75+.07, 1.5-.14, _placeBOTON*(1.5-.14))
                    ctx.restore()
                }

                const xdd = vidasY*3.5+5.5
                if (_touchEnabled) {
                    ctx.save()
                    ctx.translate(-xdd*1.5-.9, 0)
                    ctx.scale(1.25, 1.25)
                    ctx.strokeStyle = "black"
                    ctx.lineWidth = (.1+Math.sin(_time*5)*.025)/1.25
                    ctx.lineJoin = "round"
                    ctx.lineCap = "round"
                    ctx.strokeRect(-.75, -1, 1.5, 2)
                    ctx.fillStyle = "white"
                    ctx.fillRect(-.75, -1, 1.5, 2)
                    ctx.fillStyle = "rgb(255, 100, 100)"
                    ctx.fillRect(.25, .5, .5, .5)
                    for (var i = 0; i < 9; i++) {
                        drawDigit((i%3-1)*.5, (Math.floor(i/3)-1)*.5-.25, i, numerosIMG)
                    }
                    drawDigit(0, .75, 9, numerosIMG)
                    drawDigit(-.5, .75, 11, numerosIMG)
                    drawDigit(.5, .75, 12, numerosIMG)
                    ctx.restore()
                }

                if (typing) {
                    ctx.save()
                    ctx.translate(0,2)
                    ctx.scale(_typeScale,_typeScale)
                    const xd = Math.max(resultString.length-1, 0)*cacanut*.25+.01
                    ctx.beginPath()
                    ctx.moveTo(-xd, 0)
                    ctx.lineTo(xd, 0)
                    ctx.closePath()
                    ctx.lineWidth = .8+Math.sin(_time*5)*.025
                    ctx.strokeStyle = "black"
                    ctx.lineCap = "round"
                    ctx.lineJoin = "round"
                    ctx.stroke()
                    ctx.lineWidth = .7
                    ctx.strokeStyle = "white"
                    ctx.lineCap = "round"
                    ctx.lineJoin = "round"
                    ctx.stroke()
                    drawTXT(0, 0, resultString)
                    ctx.restore()
                }

                for (var i = 0; i < 3; i++) {
                    if (vidas > i) {
                        ctx.drawImage(corazonIMG, (i-1.55)*.75, vidasY, .75, .75)
                    } else {
                        ctx.drawImage(corazonF, (i-1.55)*.75, vidasY, .75, .75)
                    }
                }

                ctx.drawImage(puntajecion, xdd-cacanut*2.86*.5, -cacanut, cacanut*2.86, cacanut)
                drawTXT(xdd, cacanut*.4, puntaje+"")
                ctx.fillStyle = "black"
                ctx.globalAlpha = (1-perdisteY*.25)*.5
                ctx.fillRect(-10,-10,20,20)
                ctx.globalAlpha = 1
                ctx.drawImage(perdisteIMG, -3, -1-perdisteY, 795/128, 237/128)
                var len = cacanut*((puntaje+"").length-1)*.25
                ctx.drawImage(ppppp, -cacanut*2.86, .75+perdisteY, cacanut*2.86, cacanut)
                drawTXT(len+.15, .75+cacanut*.5+perdisteY, puntaje+"", nuemros2)
            }

            function loop() {
                _time = Date.now()*.001
                const dt = Math.min(_time - _lastTime, 1/22)

                update(dt)

                ctx.clearRect(0, 0, canvas.width, canvas.height)
                ctx.save()
                ctx.translate(canvas.width * .5, canvas.height * .5)
                ctx.scale(_scale, _scale)
                render(dt)
                ctx.restore()

                _lastTime = _time
                requestAnimationFrame(loop)
            } loop()

        </script>
    </body>
</html>
